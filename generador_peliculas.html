<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Generador JSON - King Play</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body {
    background: #121212;
    color: white;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding: 20px;
    line-height: 1.6;
}
h1, h2 {
    text-align: center;
    color: #00bfff;
    margin-bottom: 20px;
}
h1 {
    font-size: 2.2rem;
    margin-bottom: 30px;
    text-shadow: 0 2px 4px rgba(0, 191, 255, 0.3);
}
label {
    display: block;
    margin: 15px auto 5px;
    width: 90%;
    max-width: 600px;
    font-weight: bold;
}
input, select, textarea, button {
    display: block;
    margin: 5px auto 15px;
    width: 90%;
    max-width: 600px;
    padding: 12px;
    border-radius: 8px;
    font-size: 1rem;
    box-sizing: border-box;
}
input, select, textarea {
    background: #2a2a2a;
    color: white;
    border: 1px solid #444;
}
input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: #00bfff;
    box-shadow: 0 0 0 2px rgba(0, 191, 255, 0.3);
}
textarea {
    resize: vertical;
    min-height: 100px;
}
button {
    background: linear-gradient(to bottom, #00bfff, #0088cc);
    color: white;
    border: none;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 12px 20px;
}
button:hover {
    background: linear-gradient(to bottom, #00a5e0, #0077b3);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}
button:active {
    transform: translateY(0);
}
table {
    width: 90%;
    max-width: 900px;
    margin: 20px auto;
    border-collapse: collapse;
    background: #1f1f1f;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}
td, th {
    padding: 10px 15px;
    font-size: 0.9rem;
    border-bottom: 1px solid #333;
    text-align: left;
    vertical-align: middle;
}
th {
    background: linear-gradient(to bottom, #00bfff, #0088cc);
    color: #fff;
    font-size: 0.95rem;
    padding: 12px 15px;
}
tr:nth-child(even) {
    background-color: #1a1a1a;
}
tr:hover {
    background-color: #2a2a2a;
}
hr {
    margin: 40px auto;
    width: 90%;
    border: 0;
    height: 1px;
    background: linear-gradient(to right, transparent, #00bfff, transparent);
}
#temporadasLista {
    width: 90%;
    max-width: 600px;
    margin: 10px auto;
    padding: 15px;
    background: #1e1e1e;
    border-radius: 8px;
}
.temporada-item {
    margin-bottom: 15px;
    padding: 15px;
    border: 1px solid #00bfff;
    border-radius: 8px;
    background: #252525;
    position: relative;
}
.temporada-url {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    max-width: 100%;
    display: inline-block;
}
.temporada-editable {
    display: none;
}
.temporada-view {
    display: block;
}
.search-container {
    display: flex;
    justify-content: center;
    margin: 20px 0;
    gap: 10px;
}
.search-container input {
    display: inline-block;
    width: 70%;
    margin: 0;
    border-radius: 8px 0 0 8px;
}
.search-container button {
    display: inline-block;
    width: 28%;
    margin: 0;
    border-radius: 0 8px 8px 0;
}
.highlight {
    background-color: #2a2a5d !important;
    border: 2px solid #00bfff;
    animation: pulse 2s infinite;
}
@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(0, 191, 255, 0.5); }
    70% { box-shadow: 0 0 0 10px rgba(0, 191, 255, 0); }
    100% { box-shadow: 0 0 0 0 rgba(0, 191, 255, 0); }
}
.form-section {
    border: 2px solid #333;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 25px;
    background: #1e1e1e;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}
.form-title {
    text-align: center;
    color: #00bfff;
    margin-top: 0;
    font-size: 1.5rem;
}
.encryption-section {
    border: 2px solid #00bfff;
    border-radius: 10px;
    padding: 20px;
    margin: 25px auto;
    background: #1e1e1e;
    max-width: 600px;
    box-shadow: 0 4px 15px rgba(0, 191, 255, 0.2);
}
.copy-btn-container {
    display: flex;
    justify-content: center;
    margin-top: 10px;
}
.copy-btn {
    width: auto;
    padding: 8px 20px;
    font-size: 0.9rem;
}
.action-buttons {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 15px 0;
}
.action-buttons button {
    width: auto;
    padding: 8px 15px;
}
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 25px;
    background: #00bfff;
    color: white;
    border-radius: 5px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transform: translateX(100%);
    transition: transform 0.3s ease;
    z-index: 1000;
}
.notification.show {
    transform: translateX(0);
}
.serie-anime-fields {
    display: none;
}
.action-btn {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
}
.action-btn:hover {
    opacity: 0.9;
}
.btn-move-up {
    background: #4CAF50;
}
.btn-move-down {
    background: #2196F3;
}
.btn-edit {
    background: #FF9800;
}
.btn-delete {
    background: #F44336;
}
.edit-temporada-btn {
    background: #FF9800;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    margin-left: 10px;
}
.category-header {
    background: linear-gradient(to bottom, #333, #222) !important;
    font-size: 1.1rem !important;
    padding: 15px !important;
    cursor: pointer;
}
.category-header:hover {
    background: linear-gradient(to bottom, #444, #333) !important;
}
.category-content {
    display: table-row-group;
}
.content-row {
    display: table-row;
}
.content-cell {
    display: table-cell;
    padding: 10px 15px;
    vertical-align: middle;
}
.content-info {
    display: flex;
    flex-direction: column;
}
.content-title {
    font-weight: bold;
    margin-bottom: 4px;
}
.content-type {
    font-style: italic;
    color: #aaa;
    margin-bottom: 8px;
}
.content-id {
    font-size: 0.85rem;
    color: #888;
    margin-bottom: 8px;
}
.content-actions {
    display: flex;
    gap: 6px;
    justify-content: flex-start;
}
.compact-view {
    display: flex;
    flex-direction: column;
}
.compact-view .title-line {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}
.compact-view .actions-line {
    display: flex;
    gap: 6px;
}
.github-section {
    border: 2px solid #6e5494;
    border-radius: 10px;
    padding: 20px;
    margin: 25px auto;
    background: #1e1e1e;
    max-width: 600px;
    box-shadow: 0 4px 15px rgba(110, 84, 148, 0.2);
}
.github-toggle {
    background: linear-gradient(to bottom, #6e5494, #514176);
}
.github-toggle:hover {
    background: linear-gradient(to bottom, #5d4680, #42385f);
}
.github-submit {
    background: linear-gradient(to bottom, #6cc644, #56a434);
}
.github-submit:hover {
    background: linear-gradient(to bottom, #5cb234, #468c24);
}
.status-indicator {
    display: inline-block;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-right: 8px;
}
.status-success {
    background-color: #6cc644;
}
.status-error {
    background-color: #bd2c00;
}
.status-pending {
    background-color: #dbab09;
}
.github-info {
    font-size: 0.9rem;
    color: #aaa;
    margin-top: 5px;
    text-align: center;
}
.url-count {
    background: #00bfff;
    color: white;
    border-radius: 12px;
    padding: 2px 8px;
    font-size: 0.8rem;
    margin-left: 8px;
}
@media (max-width: 768px) {
    .search-container {
        flex-direction: column;
        align-items: center;
    }
    .search-container input,
    .search-container button {
        width: 90%;
        border-radius: 8px;
    }
    .action-buttons {
        flex-wrap: wrap;
    }
    .content-actions {
        flex-wrap: wrap;
    }
    .compact-view .title-line {
        flex-direction: column;
        align-items: flex-start;
    }
}
</style>
</head>
<body>

<h1>Generador JSON - King Play</h1>

<div class="form-section">
    <h2 class="form-title">Formulario de Contenido</h2>

    <label>Tipo:</label>
    <select id="tipo" onchange="alternarCampos()">
        <option value="Pelicula">Pel√≠cula</option>
        <option value="Serie">Serie</option>
        <option value="Anime">Anime</option>
        <option value="Tv">Tv</option>
    </select>

    <label>T√≠tulo:</label>
    <input type="text" id="titulo" />

    <label>Imagen URL:</label>
    <input type="text" id="imagen" />

    <!-- Campos para Pel√≠cula y TV -->
    <div id="camposPeliculaTv">
        <label>Categor√≠a (separadas por coma):</label>
        <input type="text" id="categoria" />

        <label>¬øEs estreno?</label>
        <select id="estreno">
            <option value="">No</option>
            <option value="Estreno">S√≠</option>
        </select>
    </div>

    <!-- BLOQUE PARA PEL√çCULAS -->
    <div id="bloquePelicula" style="display:block">
        <label>URL del video (Pel√≠cula):</label>
        <input type="text" id="urlPelicula" placeholder="https://..." />
    </div>

    <!-- BLOQUE PARA TV -->
    <div id="bloqueTv" style="display:none">
        <label>URL del canal (TV):</label>
        <input type="text" id="urlTv" placeholder="https://..." />
    </div>

    <!-- BLOQUE PARA SERIE Y ANIME -->
    <div id="bloqueSerieAnime" style="display:none" class="serie-anime-fields">
        <label>ID de la serie/anime:</label>
        <input type="text" id="idSerieAnime" />

        <label>Temporada:</label>
        <input type="text" id="temporada" />

        <label>URLs de cap√≠tulos (una por l√≠nea):</label>
        <textarea id="urlsCapitulos" rows="5" placeholder="https://capitulo1.com&#10;https://capitulo2.com&#10;https://capitulo3.com"></textarea>

        <button onclick="agregarTemporada()">Agregar Temporada</button>
        <div id="temporadasLista"></div>
    </div>

    <button onclick="agregarContenido()" id="agregarBtn">Agregar al JSON</button>
</div>

<div class="search-container">
    <input type="text" id="buscador" placeholder="Buscar contenido por t√≠tulo..." onkeypress="handleSearchKeyPress(event)" />
    <button onclick="buscarContenido()">Buscar</button>
</div>

<!-- SECCI√ìN DE ENCRIPTACI√ìN DEBAJO DEL BUSCADOR -->
<div class="encryption-section">
    <h2 class="form-title">Configuraci√≥n JSON</h2>

    <label>Versi√≥n del JSON:</label>
    <input type="text" id="version" value="1.0.0" />

    <label>Mensaje de actualizaci√≥n:</label>
    <input type="text" id="mensaje" value="Hay una nueva versi√≥n disponible" />

    <label>Clave de encriptaci√≥n:</label>
    <input type="text" id="clave" value="andymix1986" />

    <div class="action-buttons">
        <button onclick="generarJSON()">Generar JSON Encriptado</button>
        <button onclick="copiarJSON()" id="copiarBtn">Copiar JSON Encriptado</button>
    </div>

    <label>JSON sin encriptar:</label>
    <textarea id="jsonOutput" rows="5" readonly></textarea>

    <label>JSON encriptado:</label>
    <textarea id="jsonEncrypted" rows="3" readonly onclick="this.select()"></textarea>
</div>

<!-- SECCI√ìN DE GITHUB (OCULTA INICIALMENTE) -->
<div class="github-section" id="githubSection" style="display: none;">
    <h2 class="form-title">üîó Subir a GitHub</h2>

    <label>Token de acceso GitHub:</label>
    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" />
    <p class="github-info">Necesitas un token con permisos de repositorio. <a href="https://github.com/settings/tokens" target="_blank">Generar token</a></p>

    <label>Nombre de usuario/organizaci√≥n:</label>
    <input type="text" id="githubOwner" placeholder="tu-usuario" />

    <label>Nombre del repositorio:</label>
    <input type="text" id="githubRepo" placeholder="mi-repositorio" />

    <label>Ruta del archivo en el repositorio:</label>
    <input type="text" id="githubPath" value="data.json" />

    <label>Mensaje de commit:</label>
    <input type="text" id="githubMessage" value="Actualizaci√≥n autom√°tica desde King Play Generator" />

    <div class="action-buttons">
        <button onclick="subirAGithub()" class="github-submit">Subir a GitHub</button>
    </div>

    <div id="githubStatus"></div>
</div>

<!-- BOT√ìN PARA MOSTRAR/OCULTAR SECCI√ìN GITHUB -->
<div class="action-buttons">
    <button onclick="toggleGitHubSection()" class="github-toggle" id="toggleGitHubBtn">Mostrar Opciones de GitHub</button>
</div>

<table id="tablaContenidos">
    <thead>
        <tr>
            <th>#</th>
            <th>Contenido</th>
        </tr>
    </thead>
    <tbody id="tablaBody"></tbody>
</table>

<div class="form-section">
    <h2 class="form-title">üîí Restaurar JSON Encriptado</h2>

    <label>JSON encriptado a cargar:</label>
    <textarea id="jsonRestoreInput" rows="6" placeholder="Pega aqu√≠ el JSON encriptado..."></textarea>

    <label>Clave para desencriptar:</label>
    <input type="text" id="restoreKey" placeholder="Clave usada para encriptar" />

    <button onclick="restaurarJSON()">Restaurar contenido</button>
</div>

<div id="notification" class="notification">¬°Contenido copiado al portapapeles!</div>

<script>
let contenidos = [], temporadas = [], editIndex = -1;
let currentHighlightedRow = null;
let editandoTemporadaIndex = -1;
let categoriasExpandidas = {};

function alternarCampos() {
    const tipo = document.getElementById("tipo").value;
    const esSerieAnime = (tipo === 'Serie' || tipo === 'Anime');
    const esPelicula = (tipo === 'Pelicula');
    const esTv = (tipo === 'Tv');

    // Mostrar/ocultar bloques principales
    document.getElementById("bloquePelicula").style.display = esPelicula ? 'block' : 'none';
    document.getElementById("bloqueTv").style.display = esTv ? 'block' : 'none';
    document.getElementById("bloqueSerieAnime").style.display = esSerieAnime ? 'block' : 'none';

    // Mostrar/ocultar campos de categor√≠a y estreno
    document.getElementById("camposPeliculaTv").style.display = esSerieAnime ? 'none' : 'block';
}

function agregarTemporada() {
    const nombre = document.getElementById("temporada").value.trim();
    const urlsTexto = document.getElementById("urlsCapitulos").value.trim();

    if (!nombre || !urlsTexto) {
        alert("Completa todos los campos de la temporada.");
        return;
    }

    // Convertir el texto de URLs en un array
    const urlsArray = urlsTexto.split('\n')
        .map(url => url.trim())
        .filter(url => url.length > 0);

    if (urlsArray.length === 0) {
        alert("Debes ingresar al menos una URL v√°lida.");
        return;
    }

    // Si estamos editando una temporada existente
    if (editandoTemporadaIndex !== -1) {
        temporadas[editandoTemporadaIndex] = { 
            temporada: nombre, 
            urls: urlsArray
        };
        editandoTemporadaIndex = -1;
    } else {
        // Agregar nueva temporada
        temporadas.push({ 
            temporada: nombre, 
            urls: urlsArray
        });
    }

    document.getElementById("temporada").value = "";
    document.getElementById("urlsCapitulos").value = "";
    renderTemporadas();
}

function renderTemporadas() {
    const lista = document.getElementById("temporadasLista");
    lista.innerHTML = "";
    temporadas.forEach((t, i) => {
        const contenedor = document.createElement("div");
        contenedor.className = "temporada-item";
        contenedor.id = `temporada-${i}`;

        contenedor.innerHTML = `
        <div class="temporada-view">
            <strong>Temporada ${i + 1}: ${t.temporada}</strong>
            <span class="url-count">${t.urls.length} URLs</span><br>
            <div style="margin-top: 10px;">
                <button onclick="editarTemporada(${i})" class="edit-temporada-btn">‚úèÔ∏è Editar</button>
                <button onclick="eliminarTemporada(${i})" style="margin-left: 5px; padding: 5px 10px;">üóëÔ∏è Eliminar</button>
            </div>
        </div>
        <div class="temporada-editable">
            <strong>Editando Temporada ${i + 1}:</strong><br>
            <label>Nombre:</label>
            <input type="text" id="edit-temporada-${i}" value="${t.temporada}" />
            <label>URLs de cap√≠tulos (una por l√≠nea):</label>
            <textarea id="edit-urls-${i}" rows="5">${t.urls.join('\n')}</textarea>
            <div style="margin-top: 10px;">
                <button onclick="guardarEdicionTemporada(${i})">üíæ Guardar</button>
                <button onclick="cancelarEdicionTemporada(${i})" style="margin-left: 5px;">‚ùå Cancelar</button>
            </div>
        </div>
        `;
        lista.appendChild(contenedor);
    });
}

function editarTemporada(index) {
    // Ocultar todas las vistas y mostrar solo la editable para esta temporada
    document.querySelectorAll('.temporada-view').forEach(v => v.style.display = 'block');
    document.querySelectorAll('.temporada-editable').forEach(e => e.style.display = 'none');
    
    document.querySelector(`#temporada-${index} .temporada-view`).style.display = 'none';
    document.querySelector(`#temporada-${index} .temporada-editable`).style.display = 'block';
    
    editandoTemporadaIndex = index;
}

function guardarEdicionTemporada(index) {
    const nuevoNombre = document.getElementById(`edit-temporada-${index}`).value.trim();
    const nuevasUrlsTexto = document.getElementById(`edit-urls-${index}`).value.trim();

    if (!nuevoNombre || !nuevasUrlsTexto) {
        alert("Completa todos los campos de la temporada.");
        return;
    }

    // Convertir el texto de URLs en un array
    const nuevasUrls = nuevasUrlsTexto.split('\n')
        .map(url => url.trim())
        .filter(url => url.length > 0);

    if (nuevasUrls.length === 0) {
        alert("Debes ingresar al menos una URL v√°lida.");
        return;
    }

    temporadas[index] = {
        temporada: nuevoNombre,
        urls: nuevasUrls
    };

    // Volver a la vista normal
    document.querySelector(`#temporada-${index} .temporada-view`).style.display = 'block';
    document.querySelector(`#temporada-${index} .temporada-editable`).style.display = 'none';

    // Actualizar la visualizaci√≥n
    renderTemporadas();
}

function cancelarEdicionTemporada(index) {
    // Volver a la vista normal
    document.querySelector(`#temporada-${index} .temporada-view`).style.display = 'block';
    document.querySelector(`#temporada-${index} .temporada-editable`).style.display = 'none';
    editandoTemporadaIndex = -1;
}

function eliminarTemporada(index) {
    if (confirm("¬øEliminar esta temporada?")) {
        temporadas.splice(index, 1);
        renderTemporadas();
    }
}

function agregarContenido() {
    const tipo = document.getElementById("tipo").value;
    const titulo = document.getElementById("titulo").value.trim();
    const imagen = document.getElementById("imagen").value.trim();
    const esSerieAnime = (tipo === 'Serie' || tipo === 'Anime');

    // Validaciones b√°sicas
    if (!titulo || !imagen) {
        alert("Completa todos los campos requeridos.");
        return;
    }

    let nuevo;

    if (tipo === "Pelicula") {
        const categoria = document.getElementById("categoria").value.trim();
        const estreno = document.getElementById("estreno").value;
        const urlPelicula = document.getElementById("urlPelicula").value.trim();
        
        if (!categoria || !urlPelicula) {
            alert("Completa todos los campos para Pel√≠cula.");
            return;
        }
        
        nuevo = { tipo, titulo, imagen, categoria, estreno, url: urlPelicula };
    } else if (tipo === "Tv") {
        const categoria = document.getElementById("categoria").value.trim();
        const estreno = document.getElementById("estreno").value;
        const urlTv = document.getElementById("urlTv").value.trim();
        
        if (!categoria || !urlTv) {
            alert("Completa todos los campos para TV.");
            return;
        }
        
        nuevo = { tipo, titulo, imagen, categoria, estreno, url: urlTv };
    } else {
        // Para Series y Anime
        const idSerieAnime = document.getElementById("idSerieAnime").value.trim();
        
        if (!idSerieAnime || temporadas.length === 0) {
            alert("Completa el ID y agrega al menos una temporada.");
            return;
        }
        
        nuevo = { 
            tipo, 
            titulo, 
            imagen,
            id: idSerieAnime,
            temporadas: JSON.parse(JSON.stringify(temporadas)) 
        };
    }

    if (editIndex >= 0) {
        contenidos[editIndex] = nuevo;
        editIndex = -1;
        document.getElementById("agregarBtn").textContent = "Agregar al JSON";
    } else {
        contenidos.push(nuevo);
    }

    temporadas = [];
    editandoTemporadaIndex = -1;
    actualizarVistaJSON();
    limpiarCampos();

    // Desplazarse al formulario despu√©s de agregar
    document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
}

function limpiarCampos() {
    document.getElementById("tipo").value = "Pelicula";
    document.getElementById("titulo").value = "";
    document.getElementById("imagen").value = "";
    document.getElementById("categoria").value = "";
    document.getElementById("estreno").value = "";
    document.getElementById("urlPelicula").value = "";
    document.getElementById("urlTv").value = "";
    document.getElementById("idSerieAnime").value = "";
    document.getElementById("temporada").value = "";
    document.getElementById("urlsCapitulos").value = "";
    document.getElementById("bloqueSerieAnime").style.display = "none";
    document.getElementById("camposPeliculaTv").style.display = "block";
    document.getElementById("bloquePelicula").style.display = "block";
    document.getElementById("bloqueTv").style.display = "none";
    document.getElementById("temporadasLista").innerHTML = "";
}

function actualizarVistaJSON() {
    const version = document.getElementById("version").value;
    const mensaje = document.getElementById("mensaje").value;
    const json = { version, mensaje, contenidos };
    document.getElementById("jsonOutput").value = JSON.stringify(json, null, 2);
    actualizarTabla();
}

function actualizarTabla() {
    const tbody = document.querySelector("#tablaBody");
    tbody.innerHTML = "";

    // Agrupar contenidos por categor√≠a para Pel√≠culas y TV
    const categoriasPeliculas = {};
    const categoriasTv = {};
    const series = [];
    const animes = [];

    // Separar contenidos por tipo y categor√≠a
    contenidos.forEach((item, i) => {
        if (item.tipo === "Pelicula") {
            if (!categoriasPeliculas[item.categoria]) {
                categoriasPeliculas[item.categoria] = [];
            }
            categoriasPeliculas[item.categoria].push({ ...item, index: i });
        } else if (item.tipo === "Tv") {
            if (!categoriasTv[item.categoria]) {
                categoriasTv[item.categoria] = [];
            }
            categoriasTv[item.categoria].push({ ...item, index: i });
        } else if (item.tipo === "Serie") {
            series.push({ ...item, index: i });
        } else if (item.tipo === "Anime") {
            animes.push({ ...item, index: i });
        }
    });

    // Funci√≥n para agregar una categor√≠a a la tabla
    function agregarCategoria(tbody, tipo, categoria, items) {
        // Si la categor√≠a no est√° definida en el estado, inicializarla como expandida
        if (categoriasExpandidas[`${tipo}-${categoria}`] === undefined) {
            categoriasExpandidas[`${tipo}-${categoria}`] = true;
        }

        const isExpanded = categoriasExpandidas[`${tipo}-${categoria}`];
        const rowCount = items.length;

        // Crear fila de encabezado de categor√≠a
        const headerRow = document.createElement('tr');
        headerRow.className = 'category-header';
        headerRow.innerHTML = `
        <td colspan="2">
            <strong>${categoria} (${tipo})</strong> 
            <span style="float: right;">${isExpanded ? '‚ñº' : '‚ñ∫'} ${rowCount} elemento(s)</span>
        </td>
        `;
        headerRow.onclick = () => {
            categoriasExpandidas[`${tipo}-${categoria}`] = !categoriasExpandidas[`${tipo}-${categoria}`];
            actualizarTabla();
        };
        tbody.appendChild(headerRow);

        // Agregar elementos de la categor√≠a si est√° expandida
        if (isExpanded) {
            items.forEach(item => {
                const fila = document.createElement("tr");
                fila.id = `fila-${item.index}`;
                fila.className = "content-row";
                fila.innerHTML = `
                <td class="content-cell">${item.index + 1}</td>
                <td class="content-cell">
                    <div class="compact-view">
                        <div class="title-line">
                            <span class="content-title">${item.titulo}</span>
                            <span class="content-type">${item.tipo}</span>
                        </div>
                        ${item.id ? `<div class="content-id">ID: ${item.id}</div>` : ''}
                        <div class="actions-line">
                            <button class="action-btn btn-move-up" onclick="moverArriba(${item.index})">‚¨ÜÔ∏è</button>
                            <button class="action-btn btn-move-down" onclick="moverAbajo(${item.index})">‚¨áÔ∏è</button>
                            <button class="action-btn btn-edit" onclick="editar(${item.index})">‚úèÔ∏è</button>
                            <button class="action-btn btn-delete" onclick="eliminar(${item.index})">üóëÔ∏è</button>
                        </div>
                    </div>
                </td>
                `;
                tbody.appendChild(fila);
            });
        }
    }

    // Agregar categor√≠as de Pel√≠culas
    Object.keys(categoriasPeliculas).sort().forEach(categoria => {
        agregarCategoria(tbody, "Pel√≠cula", categoria, categoriasPeliculas[categoria]);
    });

    // Agregar categor√≠as de TV
    Object.keys(categoriasTv).sort().forEach(categoria => {
        agregarCategoria(tbody, "TV", categoria, categoriasTv[categoria]);
    });

    // Agregar Series (sin categor√≠as)
    if (series.length > 0) {
        const headerRow = document.createElement('tr');
        headerRow.className = 'category-header';
        headerRow.innerHTML = `
        <td colspan="2">
            <strong>Series</strong> 
            <span style="float: right;">${categoriasExpandidas['Series'] ? '‚ñº' : '‚ñ∫'} ${series.length} elemento(s)</span>
        </td>
        `;
        headerRow.onclick = () => {
            categoriasExpandidas['Series'] = !categoriasExpandidas['Series'];
            actualizarTabla();
        };
        tbody.appendChild(headerRow);

        if (categoriasExpandidas['Series']) {
            series.forEach(item => {
                const fila = document.createElement("tr");
                fila.id = `fila-${item.index}`;
                fila.className = "content-row";
                fila.innerHTML = `
                <td class="content-cell">${item.index + 1}</td>
                <td class="content-cell">
                    <div class="compact-view">
                        <div class="title-line">
                            <span class="content-title">${item.titulo}</span>
                            <span class="content-type">${item.tipo}</span>
                        </div>
                        ${item.id ? `<div class="content-id">ID: ${item.id}</div>` : ''}
                        <div class="actions-line">
                            <button class="action-btn btn-move-up" onclick="moverArriba(${item.index})">‚¨ÜÔ∏è</button>
                            <button class="action-btn btn-move-down" onclick="moverAbajo(${item.index})">‚¨áÔ∏è</button>
                            <button class="action-btn btn-edit" onclick="editar(${item.index})">‚úèÔ∏è</button>
                            <button class="action-btn btn-delete" onclick="eliminar(${item.index})">üóëÔ∏è</button>
                        </div>
                    </div>
                </td>
                `;
                tbody.appendChild(fila);
            });
        }
    }

    // Agregar Animes (sin categor√≠as)
    if (animes.length > 0) {
        const headerRow = document.createElement('tr');
        headerRow.className = 'category-header';
        headerRow.innerHTML = `
        <td colspan="2">
            <strong>Animes</strong> 
            <span style="float: right;">${categoriasExpandidas['Animes'] ? '‚ñº' : '‚ñ∫'} ${animes.length} elemento(s)</span>
        </td>
        `;
        headerRow.onclick = () => {
            categoriasExpandidas['Animes'] = !categoriasExpandidas['Animes'];
            actualizarTabla();
        };
        tbody.appendChild(headerRow);

        if (categoriasExpandidas['Animes']) {
            animes.forEach(item => {
                const fila = document.createElement("tr");
                fila.id = `fila-${item.index}`;
                fila.className = "content-row";
                fila.innerHTML = `
                <td class="content-cell">${item.index + 1}</td>
                <td class="content-cell">
                    <div class="compact-view">
                        <div class="title-line">
                            <span class="content-title">${item.titulo}</span>
                            <span class="content-type">${item.tipo}</span>
                        </div>
                        ${item.id ? `<div class="content-id">ID: ${item.id}</div>` : ''}
                        <div class="actions-line">
                            <button class="action-btn btn-move-up" onclick="moverArriba(${item.index})">‚¨ÜÔ∏è</button>
                            <button class="action-btn btn-move-down" onclick="moverAbajo(${item.index})">‚¨áÔ∏è</button>
                            <button class="action-btn btn-edit" onclick="editar(${item.index})">‚úèÔ∏è</button>
                            <button class="action-btn btn-delete" onclick="eliminar(${item.index})">üóëÔ∏è</button>
                        </div>
                    </div>
                </td>
                `;
                tbody.appendChild(fila);
            });
        }
    }
}

function moverArriba(i) {
    if (i > 0) {
        [contenidos[i], contenidos[i - 1]] = [contenidos[i - 1], contenidos[i]];
        actualizarVistaJSON();
    }
}

function moverAbajo(i) {
    if (i < contenidos.length - 1) {
        [contenidos[i], contenidos[i + 1]] = [contenidos[i + 1], contenidos[i]];
        actualizarVistaJSON();
    }
}

function editar(index) {
    const item = contenidos[index];
    document.getElementById("tipo").value = item.tipo;
    document.getElementById("titulo").value = item.titulo;
    document.getElementById("imagen").value = item.imagen;

    if (item.tipo === "Pelicula" || item.tipo === "Tv") {
        document.getElementById("categoria").value = item.categoria;
        document.getElementById("estreno").value = item.estreno || "";
        
        if (item.tipo === "Pelicula") {
            document.getElementById("urlPelicula").value = item.url;
        } else {
            document.getElementById("urlTv").value = item.url;
        }
    } else {
        // Para Series y Anime
        document.getElementById("idSerieAnime").value = item.id || "";
        temporadas = item.temporadas ? JSON.parse(JSON.stringify(item.temporadas)) : [];
        renderTemporadas();
    }

    editIndex = index;
    document.getElementById("agregarBtn").textContent = "Guardar Cambios";
    alternarCampos();

    // Desplazarse al formulario al editar
    document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
}

function eliminar(index) {
    if (confirm("¬øSeguro que deseas eliminar este contenido?")) {
        contenidos.splice(index, 1);
        actualizarVistaJSON();
    }
}

function xorEncrypt(str, key) {
    let result = '';
    for (let i = 0; i < str.length; i++) {
        result += String.fromCharCode(str.charCodeAt(i) ^ key.charCodeAt(i % key.length));
    }
    return result;
}

function generarJSON() {
    const clave = document.getElementById("clave").value.trim();
    if (!clave) {
        alert("Por favor ingresa una clave de encriptaci√≥n.");
        return;
    }
    const version = document.getElementById("version").value;
    const mensaje = document.getElementById("mensaje").value;
    const json = { version, mensaje, contenidos };
    const encriptado = btoa(xorEncrypt(JSON.stringify(json), clave));
    document.getElementById("jsonEncrypted").value = encriptado;
    actualizarVistaJSON();
}

function copiarJSON() {
    const jsonEncrypted = document.getElementById("jsonEncrypted");
    if (!jsonEncrypted.value) {
        alert("Primero genera el JSON encriptado.");
        return;
    }
    jsonEncrypted.select();
    document.execCommand("copy");
    mostrarNotificacion("¬°JSON encriptado copiado al portapapeles!");
}

function mostrarNotificacion(mensaje) {
    const notification = document.getElementById("notification");
    notification.textContent = mensaje;
    notification.classList.add("show");
    setTimeout(() => {
        notification.classList.remove("show");
    }, 3000);
}

function xorDecrypt(str, key) {
    let result = '';
    for (let i = 0; i < str.length; i++) {
        result += String.fromCharCode(str.charCodeAt(i) ^ key.charCodeAt(i % key.length));
    }
    return result;
}

function restaurarJSON() {
    const clave = document.getElementById("restoreKey").value.trim();
    const data = document.getElementById("jsonRestoreInput").value.trim();
    if (!clave || !data) {
        alert("Debes ingresar el JSON encriptado y la clave.");
        return;
    }
    try {
        const desencriptado = xorDecrypt(atob(data), clave);
        const obj = JSON.parse(desencriptado);
        document.getElementById("version").value = obj.version || "1.0.0";
        document.getElementById("mensaje").value = obj.mensaje || "";
        contenidos = Array.isArray(obj.contenidos) ? obj.contenidos : [];
        categoriasExpandidas = {}; // Resetear estado de categor√≠as expandidas
        actualizarVistaJSON();
        mostrarNotificacion("Contenido restaurado correctamente.");
    } catch (e) {
        alert("Error al desencriptar. Verifica la clave o el contenido.");
        console.error(e);
    }
}

// Funci√≥n para buscar contenido
function buscarContenido() {
    const searchTerm = document.getElementById("buscador").value.toLowerCase().trim();

    if (!searchTerm) {
        alert("Por favor, ingresa un t√©rmino de b√∫squeda.");
        return;
    }

    // Quitar highlight anterior si existe
    if (currentHighlightedRow) {
        currentHighlightedRow.classList.remove("highlight");
        currentHighlightedRow = null;
    }

    // Buscar coincidencias
    let foundIndex = -1;
    for (let i = 0; i < contenidos.length; i++) {
        if (contenidos[i].titulo.toLowerCase().includes(searchTerm)) {
            foundIndex = i;
            break;
        }
    }

    if (foundIndex === -1) {
        alert("No se encontr√≥ ning√∫n contenido con ese t√≠tulo.");
        return;
    }

    // Resaltar la fila encontrada
    const fila = document.getElementById(`fila-${foundIndex}`);
    if (fila) {
        fila.classList.add("highlight");
        currentHighlightedRow = fila;

        // Expandir la categor√≠a si est√° colapsada
        for (const key in categoriasExpandidas) {
            if (key.includes(contenidos[foundIndex].tipo) || 
                (contenidos[foundIndex].tipo === "Pelicula" && key.includes("Pel√≠cula")) ||
                (contenidos[foundIndex].tipo === "Tv" && key.includes("TV"))) {
                categoriasExpandidas[key] = true;
                break;
            }
        }

        // Actualizar tabla para mostrar la categor√≠a expandida
        actualizarTabla();

        // Desplazarse a la fila encontrada
        setTimeout(() => {
            const highlightedRow = document.getElementById(`fila-${foundIndex}`);
            if (highlightedRow) {
                highlightedRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }, 100);
    }
}

// Permitir b√∫squeda con la tecla Enter
function handleSearchKeyPress(event) {
    if (event.key === 'Enter') {
        buscarContenido();
    }
}

// Funciones para GitHub
function toggleGitHubSection() {
    const githubSection = document.getElementById('githubSection');
    const toggleBtn = document.getElementById('toggleGitHubBtn');
    if (githubSection.style.display === 'none') {
        githubSection.style.display = 'block';
        toggleBtn.textContent = 'Ocultar Opciones de GitHub';
    } else {
        githubSection.style.display = 'none';
        toggleBtn.textContent = 'Mostrar Opciones de GitHub';
    }
}

async function subirAGithub() {
    const token = document.getElementById('githubToken').value.trim();
    const owner = document.getElementById('githubOwner').value.trim();
    const repo = document.getElementById('githubRepo').value.trim();
    const path = document.getElementById('githubPath').value.trim();
    const message = document.getElementById('githubMessage').value.trim();
    const encryptedContent = document.getElementById('jsonEncrypted').value;

    // Validar campos
    if (!token || !owner || !repo || !path || !message) {
        mostrarEstadoGitHub('Por favor, completa todos los campos', 'error');
        return;
    }

    if (!encryptedContent) {
        mostrarEstadoGitHub('Primero genera el JSON encriptado', 'error');
        return;
    }

    mostrarEstadoGitHub('Subiendo a GitHub...', 'pending');

    try {
        // Primero, intentamos obtener el SHA del archivo existente (si existe)
        let sha = null;
        try {
            const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
                method: 'GET',
                headers: {
                    'Authorization': `token ${token}`,
                    'User-Agent': 'KingPlay-Generator'
                }
            });

            if (response.ok) {
                const data = await response.json();
                sha = data.sha;
            }
        } catch (e) {
            // El archivo probablemente no existe, continuamos sin SHA
            console.log('Archivo no existente, se crear√° uno nuevo');
        }

        // Codificar contenido en base64
        const content = btoa(encryptedContent);

        // Configurar la solicitud para crear/actualizar el archivo
        const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
            method: 'PUT',
            headers: {
                'Authorization': `token ${token}`,
                'Content-Type': 'application/json',
                'User-Agent': 'KingPlay-Generator'
            },
            body: JSON.stringify({
                message: message,
                content: content,
                sha: sha
            })
        });

        if (response.ok) {
            const data = await response.json();
            mostrarEstadoGitHub('¬°Archivo subido correctamente a GitHub!', 'success');
            console.log('Archivo subido:', data);
        } else {
            const error = await response.json();
            mostrarEstadoGitHub(`Error: ${error.message}`, 'error');
            console.error('Error al subir:', error);
        }
    } catch (error) {
        mostrarEstadoGitHub(`Error de conexi√≥n: ${error.message}`, 'error');
        console.error('Error:', error);
    }
}

function mostrarEstadoGitHub(mensaje, tipo) {
    const statusElement = document.getElementById('githubStatus');
    let iconClass = '';
    let statusText = '';

    switch (tipo) {
        case 'success':
            iconClass = 'status-success';
            statusText = '<span class="status-indicator status-success"></span> ' + mensaje;
            statusElement.style.color = '#6cc644';
            break;
        case 'error':
            iconClass = 'status-error';
            statusText = '<span class="status-indicator status-error"></span> ' + mensaje;
            statusElement.style.color = '#bd2c00';
            break;
        case 'pending':
            iconClass = 'status-pending';
            statusText = '<span class="status-indicator status-pending"></span> ' + mensaje;
            statusElement.style.color = '#dbab09';
            break;
    }

    statusElement.innerHTML = statusText;
}

// Inicializar
alternarCampos();
</script>
</body>
</html>
